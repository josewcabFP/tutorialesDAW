---
layout: post
name: Configuración de cliente SSH con Github
asignatura: sistemas
---

# Introducción

> Esta guía esta hecha para la conexión desde un ordenador con un sistema operativo linux. Windows no tiene las librerias SSH por defecto y necesita programas como **Putty**.

En esta guía veremos como crear una clave SSH y configurar un agente SSH para nuestras conexiones remotas.

## Concepto de clave pública y privada

Con la masificación de las telecomunicaciones, surge la necesidad de autenticar nuestra identidad de alguna manera, para poder llevar a cabo transacciones seguras en la red.

Sin embargo las credenciales comunes (usuario y contraseña) pueden ser bastante vulnerables, ademas de no autentificar nuestra identidad ante un servidor.

En vista de esta necesidad, se usan métodos criptológicos para fortalecer nuestras credenciales. Un claro ejemplo de estos métodos son el sistema de clave pública y clave privada (criptografía asimetrica).

---


![clave asimetrica]({{site.baseurl}}/assets/recursos/ssh_git/CriptografiaAsimetrica.png)

1. Ana redacta un mensaje.
2. Ana cifra el mensaje con la **clave pública** de David.
3. Ana envía el mensaje cifrado a David a través de internet, ya sea por correo electrónico, mensajería instantánea o cualquier otro medio.
4. David recibe el mensaje cifrado y lo descifra con su **clave privada**.
5. David ya puede leer el mensaje original que le mandó Ana.

---

Ambas claves pueden ser cadenas de caracteres muy largas (dependiendo de lo especificado al crearlas) por lo que es muy difícil decifrarlas.

> Debemos tener en cuenta **solo se compartira la clave pública** ya que la **clave privada** solo debemos tenerla nosotros.

## Secure Shell (SSH)

Secure Shell es un protocolo de comunicaciones, cuya función es el acceso remoto a un servidor, mediante el uso de un canal cifrado de comunicación.

La conexión se realiza mediante credenciales (usuario y contraseña o claves SSH).

Mediante este sistema podemos conectarnos a un terminal y usarlo como si estuvieramos en él.

## Conexión con Github

Github permite las conexiones SSH para los repositorios remotos. 

> Recordemos que hacer un **push** o un **pull** requiere un conexión con el repositorio, por lo que siempre nos solicitará las credenciales para realizar cambios/copias en el repositorio remoto.

Utilizando claves SSH podemos realizar la conexión mediante el agente SSH en lugar de escribir nuestro usuario y contraseña en cada visita al repositorio.

### Comprobando la existencia de claves SSH

1. Abrimos el terminal y escribimos el comando

    ```bash
    ls -la ~/.ssh       
    
    # listamos el contenido de la carpeta .ssh
    ```
2. Si la carpeta no contiene nada, significa que no poseemos claves SSH.

### Creación de claves SSH 

1. Escribimos el siguiente comando en la terminal

    ```bash
    ssh-keygen -t rsa -b 4096 -C "tu_email@ejemplo.com"

    # El comando ssh-keygen nos permite crear claves
    # - La opción [-t] permite especificar el algoritmo de cifrado.
    # - La opción [-b] permite especificar el tamaño de la clave.
    # - La opción [-C] permite especificar un comentario para una mejor identificación de la clave.
    ```
2. Se generará la clave y nos preguntará la ubicación para el guardado de la misma 

    ```
     Enter a file in wich to save the key (/home/you/.ssh/id_rsa): [Press enter]
    ```

    Debemos aceptar la ruta por defecto para evitar problemas, asi que presionaremos enter sin introducir ningun argumento.

3. Se nos pedirá una contraseña para el uso de nuestra clave SSH , es decir, esta contraseña se nos solicitará cada vez que que nuestra clave SSH sea usada. También es posible no usar ninguna contraseña pero, de esta manera, cualquier persona podría usar nuestra clave SSH.

    ```
    Enter passphrase (empty for no passphrase): [Type a passphrase]

    Enter same passphrase again: [Type passphrase again]
    ```
Una vez terminado este proceso ya tendremos creada la clave SSH.

### Agregando la clave privada SSH al agente SSH

1. Primero ejecutamos el agente SSH en segundo plano

    ```bash
    eval "$(ssh-agent -s)"
    ```

2. Agregamos el la clave al agente SSH

    ```bash
    ssh-add ~/.shh/id_rsa
    ```

### Agregando la clave publica SSH a Github

1. Primero necesitamos copiar el contenido de la clave pública, para lo cual usaremos el comando **xclip**, si no lo tenemos debemos instalar el paquete correspondiente.

    ```bash
    sudo apt-get install xclip 
    # Este programa permite copiar en el portapapeles el contendio de un archivo (equivale a un CTRL + C).
    ```



2. Copiaremos el contenido de la clave.

    ```bash
    xclip -sel clip < ~/.ssh/id_rsa.pub
    ```
    > El archivo debe ser el terminado en **.pub**, que es el de la clave pública.

3. A continuación iremos a nuestra cuenta de Github e iremos al menu de ajustes de la cuenta (en la parte superior derecha).

    ![Github settings]({{site.baseurl}}/assets/recursos/ssh_git/GH1.png)

4. En el panel de ajustes buscaremos **SSH and GPG keys**.

    ![Github ssh & gpg keys]({{site.baseurl}}/assets/recursos/ssh_git/GH2.png)

5. Daremos clic a **new SSH key**.

    ![Github new key]({{site.baseurl}}/assets/recursos/ssh_git/GH3.png)

6. En el titulo pondremos algo identificativo para nuestra clave SSH.

7. Pegaremos la clave SSH en el campo de clave (key)

    ![Github key field]({{site.baseurl}}/assets/recursos/ssh_git/GH4.png)

8. Daremos a **Add SSH key**

    ![Github agree]({{site.baseurl}}/assets/recursos/ssh_git/GH5.png)

9. Github nos solicitará logear para aplicar la clave.

    ![Github confirm]({{site.baseurl}}/assets/recursos/ssh_git/GH6.png)

10. Comprobamos la conexión SSH

    ```bash
    ssh -T git@github.com
    ```
    Nos preguntara si deseamos la conexión con esta clave

    ```
    Are you sure you want to continue connecting (yes/no)?
    ```

    Escribiremos "**yes**" y nos confirmará la conexión saludandonos.

    ```
    Hi [username]! You've successfully authenticated, but GitHub does not provide shell access.
    ```

    

### Conexión SSH con Github

De ahora en adelante cada conexión con el repositorio remoto se hara con la clave SSH.

1. Primero debemos saber cual es la dirección para conexiones SSH con el repositorio, por lo que en nuestra cuenta de Github buscaremos el repositorio y en la opción de **Clone or download**, daremos a **Use SSH**

    ![Use SSH]({{site.baseurl}}/assets/recursos/ssh_git/use_ssh.png)

2. Copiaremos la dirección que nos da para la conexión SSH.

    ![link SSH]({{site.baseurl}}/assets/recursos/ssh_git/linkGithub.png)

3. Usaremos el link con el comando **remote** de _git_.

    ```bash
    git remote add [nombre para repositorio remoto] [link conexión SSH] # Agregamos la dirección del repositorio.

    git remote -v # Comprobamos que se ha agregado correctamente.
    ```

A partir de ahora para cualquier **push** o **pull** ya no nos pedirá autenticarnos con el usuario y contraseña.

> Podemos utilizar nuestro par de claves SSH (pública y privada) en otro ordenador, simplemente copiandolas de la carpeta  ```~/.ssh ``` a la misma ubicación en el otro ordenador.












